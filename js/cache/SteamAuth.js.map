{"version":3,"sources":["SteamAuth.js"],"names":["rootObjectName","window","__GRN","ready","SteamAuth","userSteam64","userSteamProfileData","onAuthenticatedCallbacks","hasBeenAuthenticated","handleProfileDataForUserAvailable","userDataString","JSON","parse","awaitModulePrepared","Debug","writeConsoleMessage","LOG_LEVEL_INFO","writeConsoleObject","bind","this","$steamProfiles","document","querySelectorAll","i","j","length","innerHTML","statusCode","$OAADownloadLink","createElement","classList","add","setAttribute","appendChild","cloneNode","steamid","profile","$nameContainer","$unrankedMMR","$rankedMMR","$MMRContainer","$unrankedMMRNumber","$rankedMMRNumber","name","replace","unrankedMMR","rankedMMR","avatar","$userAvatar","steamAuthElements","remove","items","currentUserSteam32","handleRunCallback","modulePrepared","handleProfileDataForUserUnableToBeResolved","error","LOG_LEVEL_ERROR","handleUpdateNavToRequiresAuthentication","authButtons","handleFetchUserProfileData","localStorage","setItem","Date","now","userDataStr","getItem","parts","split","Number","splice","join","fetch","cache","then","response","text","responseText","catch","handleUpdateNavToAuthenticated","__init","l","replacement","parentNode","replaceChild","style","head","encodeURIComponent","location","origin","pathname","steamAuthChallenge","indexOf","steamAuthSet","identity","URL","searchParamValue","e","registerOnAuthenticatedCallback","callback","push","baseInt","subtInt","resultInt","steam64chars","reverse","steamTConstChars","steam32Chars","carry","toString","currentUserSteam64","moduleReady"],"mappings":"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","file":"SteamAuth.js","sourcesContent":["!(function() {\n    var rootObjectName = window.__GRN;\n\n    window[rootObjectName].ready(function() {\n        window[rootObjectName].SteamAuth = (function () {\n            var userSteam64              = 0;\n            var userSteamProfileData     = null;\n            var onAuthenticatedCallbacks = [];\n            var hasBeenAuthenticated     = false;\n\n            var handleUpdateNavToAuthenticated = function() {\n                if (!userSteam64) {\n                    handleUpdateNavToRequiresAuthentication();\n                }\n\n                window[rootObjectName].awaitModulePrepared('Debug', function() {\n                    window[rootObjectName].Debug.writeConsoleMessage('User is currently authenticated', 'SteamAuth', window[rootObjectName].Debug.LOG_LEVEL_INFO);\n                });\n\n                hasBeenAuthenticated = true;\n\n                // Now build the profile display for the user and do highlighting in the DOM\n                var userDataStr = window.localStorage.getItem('OAAGGSUP');\n\n                if (userDataStr) {\n                    var parts = userDataStr.split(':');\n                    var expiration = Number(parts.splice(0, 1));\n\n                    if (expiration > Date.now()) {\n                        handleProfileDataForUserAvailable(parts.join(':'));\n\n                        return;\n                    }\n                }\n\n                // If we got here...userdata doesn't exist, so fetch it\n                window.fetch('https://chrisinajar.com:4969/users/' + window[rootObjectName].SteamAuth.currentUserSteam32, {\n                    cache: \"default\",\n                })\n                    .then(function(response) {\n                        response.text()\n                            .then(function(responseText) {\n                                // Cached for 5 minutes at a time\n                                window.localStorage.setItem('OAAGGSUP', (Date.now() + 300000) + ':' + responseText);\n\n                                handleProfileDataForUserAvailable(responseText);\n                            })\n                            .catch(handleProfileDataForUserUnableToBeResolved);\n                    })\n                    .catch(handleProfileDataForUserUnableToBeResolved);\n            };\n\n            var handleProfileDataForUserAvailable = function(userDataString) {\n                // Make a workable object here\n                userSteamProfileData = JSON.parse(userDataString);\n\n                window[rootObjectName].awaitModulePrepared('Debug', function(userSteamProfileData) {\n                    window[rootObjectName].Debug.writeConsoleMessage('Current authenticated user object', 'SteamAuth', window[rootObjectName].Debug.LOG_LEVEL_INFO);\n                    window[rootObjectName].Debug.writeConsoleObject(userSteamProfileData, 'SteamAuth', window[rootObjectName].Debug.LOG_LEVEL_INFO);\n                }.bind(this, userSteamProfileData));\n\n                var $steamProfiles = document.querySelectorAll('.steamProfile');\n                var i = 0;\n                var j = $steamProfiles.length;\n\n                // In the event this gets run again (Say we are testing, or someone puts something in there as a placeholder etc.) Clear out this element quickly\n                for (i; i < j; i++) {\n                    $steamProfiles[i].innerHTML = '';\n                }\n\n                if (userSteamProfileData && userSteamProfileData.statusCode && (userSteamProfileData.statusCode === 404)) {\n                    window[rootObjectName].awaitModulePrepared('Debug', function() {\n                        window[rootObjectName].Debug.writeConsoleMessage('User was not able to be found in BottlePass server!', 'SteamAuth', window[rootObjectName].Debug.LOG_LEVEL_INFO);\n                    });\n\n                    // Tell the user to play and maybe link the steam workshop page here?\n                    var $OAADownloadLink = document.createElement('a');\n\n                    $OAADownloadLink.classList.add('OAADownloadLink');\n\n                    $OAADownloadLink.setAttribute('target', '_blank');\n                    $OAADownloadLink.setAttribute('href', 'https://steamcommunity.com/sharedfiles/filedetails/?id=881541807');\n                    $OAADownloadLink.innerHTML = 'Subscribe<br />to play';\n\n                    i = 0;\n\n                    for (i; i < j; i++) {\n                        $steamProfiles[i].appendChild($OAADownloadLink.cloneNode(true));\n                    }\n                } else if (userSteamProfileData && userSteamProfileData.steamid && userSteamProfileData.profile) {\n                    window[rootObjectName].awaitModulePrepared('Debug', function() {\n                        window[rootObjectName].Debug.writeConsoleMessage('User found in BottlePass server!', 'SteamAuth', window[rootObjectName].Debug.LOG_LEVEL_INFO);\n                    });\n\n                    // Build the nav for your MMR\n                    var $nameContainer = document.createElement('div');\n                    var $unrankedMMR = document.createElement('div');\n                    var $rankedMMR = document.createElement('div');\n                    var $MMRContainer = document.createElement('div');\n\n                    var $unrankedMMRNumber = document.createElement('span');\n                    var $rankedMMRNumber = document.createElement('span');\n\n                    $nameContainer.innerHTML = userSteamProfileData.profile.name.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;');\n\n                    $nameContainer.classList.add('SteamUserName');\n\n                    $unrankedMMRNumber.innerHTML = userSteamProfileData.unrankedMMR;\n                    $rankedMMRNumber.innerHTML = userSteamProfileData.rankedMMR;\n\n                    $unrankedMMRNumber.classList.add('OAAUnrankedMMRValue');\n                    $rankedMMRNumber.classList.add('OAARankedMMRValue');\n\n                    $unrankedMMR.classList.add('OAAUnrankedMMR');\n                    $rankedMMR.classList.add('OAARankedMMR');\n\n                    $MMRContainer.classList.add('OAAMMRValues');\n\n                    $unrankedMMR.appendChild($unrankedMMRNumber);\n                    $rankedMMR.appendChild($rankedMMRNumber);\n\n                    $MMRContainer.appendChild($unrankedMMR);\n                    $MMRContainer.appendChild($rankedMMR);\n\n                    i = 0;\n\n                    for (i; i < j; i++) {\n                        $steamProfiles[i].appendChild($nameContainer.cloneNode(true));\n                        $steamProfiles[i].appendChild($MMRContainer.cloneNode(true));\n                    }\n\n                    // Make their avatar available in layout?\n                    if (userSteamProfileData.profile.avatar) {\n                        var $userAvatar = document.createElement('img');\n\n                        $userAvatar.setAttribute('src', userSteamProfileData.profile.avatar);\n\n                        $userAvatar.classList.add('SteamUserAvatar');\n\n                        // Aside Avatar for the moment\n                        // $steamProfile.appendChild($userAvatar);\n                    }\n                } else {\n                    window[rootObjectName].awaitModulePrepared('Debug', function() {\n                        window[rootObjectName].Debug.writeConsoleMessage('User data appears corrupted?', 'SteamAuth', window[rootObjectName].Debug.LOG_LEVEL_INFO);\n                    });\n\n                    // TODO: Catch?\n                }\n\n                var steamAuthElements = document.querySelectorAll('.steamAuth');\n                i = 0;\n                j = steamAuthElements.length;\n\n                for (i; i < j; i++) {\n                    steamAuthElements[i].classList.remove('loading');\n                    steamAuthElements[i].classList.add('authenticated');\n                }\n\n                window[rootObjectName].awaitModulePrepared('Debug', function() {\n                    window[rootObjectName].Debug.writeConsoleMessage('Running onAuthenticated callbacks', 'SteamAuth', window[rootObjectName].Debug.LOG_LEVEL_INFO);\n                });\n\n                // Highlight any Steam32 segments we have in the DOM\n                var items = document.querySelectorAll('.OAAS32_' + window[rootObjectName].SteamAuth.currentUserSteam32);\n                i = 0;\n                j = items.length;\n\n                for (i; i < j; i++) {\n                    items[i].classList.add('OAA_currentSteamUser');\n                }\n\n                i = 0;\n                j = onAuthenticatedCallbacks.length;\n\n                for (i; i < j; i++) {\n                    window[rootObjectName].handleRunCallback(onAuthenticatedCallbacks[i]);\n                }\n\n                window[rootObjectName].modulePrepared('SteamAuth');\n            };\n\n            var handleProfileDataForUserUnableToBeResolved = function(error) {\n                window[rootObjectName].awaitModulePrepared('Debug', function(error) {\n                    window[rootObjectName].Debug.writeConsoleMessage('User profile data was unable to be fetched!', 'SteamAuth', window[rootObjectName].Debug.LOG_LEVEL_ERROR);\n                    window[rootObjectName].Debug.writeConsoleObject(error, 'SteamAuth', window[rootObjectName].Debug.LOG_LEVEL_ERROR);\n                }.bind(this, error));\n            };\n\n            var handleUpdateNavToRequiresAuthentication = function() {\n                window[rootObjectName].awaitModulePrepared('Debug', function() {\n                    window[rootObjectName].Debug.writeConsoleMessage('User is not currently authenticated', 'SteamAuth', window[rootObjectName].Debug.LOG_LEVEL_INFO);\n                });\n\n                var authButtons = document.querySelectorAll('.steamAuth');\n                var i = 0;\n                var j = authButtons.length;\n\n                for (i; i < j; i++) {\n                    authButtons[i].classList.remove('loading');\n                }\n\n                window[rootObjectName].awaitModulePrepared('Debug', function() {\n                    window[rootObjectName].Debug.writeConsoleMessage('Bound interactions for nav button for authentication', 'SteamAuth', window[rootObjectName].Debug.LOG_LEVEL_INFO);\n                });\n\n                window[rootObjectName].modulePrepared('SteamAuth');\n            };\n\n            var handleFetchUserProfileData = function() {\n                // Cached for 1 week at a time\n                // TODO: Need to make a clear case for this information!\n                window.localStorage.setItem('OAAGGS64', (Date.now() + 604800000) + ':' + userSteam64);\n\n                handleUpdateNavToAuthenticated();\n            };\n\n            return {\n                __init: function() {\n                    // Make sure SS has our button markup\n                    var l = document.querySelectorAll('a[href=\"#OAALoader\"]');\n\n                    if (l.length) {\n                        var replacement = document.createElement('div');\n\n                        replacement.classList.add('steamAuth');\n                        replacement.classList.add('loading');\n\n                        replacement.innerHTML = '<div class=\"steamLoader\"> <svg width=\"30px\" height=\"30px\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\" preserveAspectRatio=\"xMidYMid\" class=\"uil-default\"> <rect x=\"46.5\" y=\"40\" width=\"7\" height=\"20\" rx=\"5\" ry=\"5\" fill=\"#AAAAAA\" transform=\"rotate(0 50 50) translate(0 -30)\"> <animate attributeName=\"opacity\" from=\"1\" to=\"0\" dur=\"1s\" begin=\"0s\" repeatCount=\"indefinite\"></animate> </rect> <rect x=\"46.5\" y=\"40\" width=\"7\" height=\"20\" rx=\"5\" ry=\"5\" fill=\"#AAAAAA\" transform=\"rotate(30 50 50) translate(0 -30)\"> <animate attributeName=\"opacity\" from=\"1\" to=\"0\" dur=\"1s\" begin=\"0.08333333333333333s\" repeatCount=\"indefinite\"></animate> </rect> <rect x=\"46.5\" y=\"40\" width=\"7\" height=\"20\" rx=\"5\" ry=\"5\" fill=\"#AAAAAA\" transform=\"rotate(60 50 50) translate(0 -30)\"> <animate attributeName=\"opacity\" from=\"1\" to=\"0\" dur=\"1s\" begin=\"0.16666666666666666s\" repeatCount=\"indefinite\"></animate> </rect> <rect x=\"46.5\" y=\"40\" width=\"7\" height=\"20\" rx=\"5\" ry=\"5\" fill=\"#AAAAAA\" transform=\"rotate(90 50 50) translate(0 -30)\"> <animate attributeName=\"opacity\" from=\"1\" to=\"0\" dur=\"1s\" begin=\"0.25s\" repeatCount=\"indefinite\"></animate> </rect> <rect x=\"46.5\" y=\"40\" width=\"7\" height=\"20\" rx=\"5\" ry=\"5\" fill=\"#AAAAAA\" transform=\"rotate(120 50 50) translate(0 -30)\"> <animate attributeName=\"opacity\" from=\"1\" to=\"0\" dur=\"1s\" begin=\"0.3333333333333333s\" repeatCount=\"indefinite\"></animate> </rect> <rect x=\"46.5\" y=\"40\" width=\"7\" height=\"20\" rx=\"5\" ry=\"5\" fill=\"#AAAAAA\" transform=\"rotate(150 50 50) translate(0 -30)\"> <animate attributeName=\"opacity\" from=\"1\" to=\"0\" dur=\"1s\" begin=\"0.4166666666666667s\" repeatCount=\"indefinite\"></animate> </rect> <rect x=\"46.5\" y=\"40\" width=\"7\" height=\"20\" rx=\"5\" ry=\"5\" fill=\"#AAAAAA\" transform=\"rotate(180 50 50) translate(0 -30)\"> <animate attributeName=\"opacity\" from=\"1\" to=\"0\" dur=\"1s\" begin=\"0.5s\" repeatCount=\"indefinite\"></animate> </rect> <rect x=\"46.5\" y=\"40\" width=\"7\" height=\"20\" rx=\"5\" ry=\"5\" fill=\"#AAAAAA\" transform=\"rotate(210 50 50) translate(0 -30)\"> <animate attributeName=\"opacity\" from=\"1\" to=\"0\" dur=\"1s\" begin=\"0.5833333333333334s\" repeatCount=\"indefinite\"></animate> </rect> <rect x=\"46.5\" y=\"40\" width=\"7\" height=\"20\" rx=\"5\" ry=\"5\" fill=\"#AAAAAA\" transform=\"rotate(240 50 50) translate(0 -30)\"> <animate attributeName=\"opacity\" from=\"1\" to=\"0\" dur=\"1s\" begin=\"0.6666666666666666s\" repeatCount=\"indefinite\"></animate> </rect> <rect x=\"46.5\" y=\"40\" width=\"7\" height=\"20\" rx=\"5\" ry=\"5\" fill=\"#AAAAAA\" transform=\"rotate(270 50 50) translate(0 -30)\"> <animate attributeName=\"opacity\" from=\"1\" to=\"0\" dur=\"1s\" begin=\"0.75s\" repeatCount=\"indefinite\"></animate> </rect> <rect x=\"46.5\" y=\"40\" width=\"7\" height=\"20\" rx=\"5\" ry=\"5\" fill=\"#AAAAAA\" transform=\"rotate(300 50 50) translate(0 -30)\"> <animate attributeName=\"opacity\" from=\"1\" to=\"0\" dur=\"1s\" begin=\"0.8333333333333334s\" repeatCount=\"indefinite\"></animate> </rect> <rect x=\"46.5\" y=\"40\" width=\"7\" height=\"20\" rx=\"5\" ry=\"5\" fill=\"#AAAAAA\" transform=\"rotate(330 50 50) translate(0 -30)\"> <animate attributeName=\"opacity\" from=\"1\" to=\"0\" dur=\"1s\" begin=\"0.9166666666666666s\" repeatCount=\"indefinite\"></animate> </rect> </svg> </div> <div class=\"steamProfile\"></div> <a class=\"steamAuthLink\"> <svg xmlns=\"http://www.w3.org/2000/svg\" version=\"1.1\" viewBox=\"0 0 233 233\"> <path fill=\"#233950\" d=\"m4.8911 150.01c14.393 48.01 58.916 82.99 111.61 82.99 64.34 0 116.5-52.16 116.5-116.5 0-64.341-52.16-116.5-116.5-116.5-61.741 0-112.26 48.029-116.25 108.76 7.5391 12.66 10.481 20.49 4.6411 41.25z\"/> <path fill=\"#FFFFFF\" d=\"m110.5 87.322c0 0.196 0 0.392 0.01 0.576l-28.508 41.412c-4.618-0.21-9.252 0.6-13.646 2.41-1.937 0.79-3.752 1.76-5.455 2.88l-62.599-25.77c0.00049 0-1.4485 23.83 4.588 41.59l44.254 18.26c2.222 9.93 9.034 18.64 19.084 22.83 16.443 6.87 35.402-0.96 42.242-17.41 1.78-4.3 2.61-8.81 2.49-13.31l40.79-29.15c0.33 0.01 0.67 0.02 1 0.02 24.41 0 44.25-19.9 44.25-44.338 0-24.44-19.84-44.322-44.25-44.322-24.4 0-44.25 19.882-44.25 44.322zm-6.84 83.918c-5.294 12.71-19.9 18.74-32.596 13.45-5.857-2.44-10.279-6.91-12.83-12.24l14.405 5.97c9.363 3.9 20.105-0.54 23.997-9.9 3.904-9.37-0.525-20.13-9.883-24.03l-14.891-6.17c5.746-2.18 12.278-2.26 18.381 0.28 6.153 2.56 10.927 7.38 13.457 13.54s2.52 12.96-0.04 19.1m51.09-54.38c-16.25 0-29.48-13.25-29.48-29.538 0-16.275 13.23-29.529 29.48-29.529 16.26 0 29.49 13.254 29.49 29.529 0 16.288-13.23 29.538-29.49 29.538m-22.09-29.583c0-12.253 9.92-22.191 22.14-22.191 12.23 0 22.15 9.938 22.15 22.191 0 12.254-9.92 22.183-22.15 22.183-12.22 0-22.14-9.929-22.14-22.183z\"/> </svg> <span>Login<br />with Steam</span> </a>';\n\n                        var i = 0;\n                        var j = l.length;\n\n                        for (i; i < j; i++) {\n                            l[i].parentNode.replaceChild(replacement.cloneNode(true), l[i]);\n                        }\n\n                        // And keep styling too\n                        var style = document.createElement('style');\n\n                        style.innerHTML = '@-webkit-keyframes -nav-mmr-rotate-unranked{0%,20%,80%,100%{opacity:1;-webkit-transform:none;transform:none}30%,70%{opacity:0;-webkit-transform:rotateX(180deg);transform:rotateX(180deg)}}@keyframes -nav-mmr-rotate-unranked{0%,20%,80%,100%{opacity:1;-webkit-transform:none;transform:none}30%,70%{opacity:0;-webkit-transform:rotateX(180deg);transform:rotateX(180deg)}}@-webkit-keyframes -nav-mmr-rotate-ranked{0%,20%,80%,100%{opacity:0;-webkit-transform:rotateX(180deg);transform:rotateX(180deg)}30%,70%{opacity:1;-webkit-transform:none;transform:none}}@keyframes -nav-mmr-rotate-ranked{0%,20%,80%,100%{opacity:0;-webkit-transform:rotateX(180deg);transform:rotateX(180deg)}30%,70%{opacity:1;-webkit-transform:none;transform:none}}.steamAuth{position:relative}.steamAuth>*{transition:.4s ease-out;}.steamAuth:not(.loading) .steamLoader,.steamAuth:not(.loaded) .steamLoader{opacity:0;pointer-events:none}.steamAuth.loading .steamAuthLink,.steamAuth.loading .steamProfile{opacity:0;pointer-events:none}.steamAuth.loaded .steamAuthLink{opacity:0;pointer-events:none}.steamAuth.authenticated .steamLoader,.steamAuth.authenticated .steamAuthLink{opacity:0;pointer-events:none}.steamAuth.authenticated .steamProfile{pointer-events:all}.steamAuth .OAADownloadLink{text-align:center;line-height:1.4em;padding:2px;height:100%;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-align-items:center;align-items:center}.steamAuth .steamLoader{position:absolute;width:100%;height:100%;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-align-items:center;align-items:center}.steamAuth .steamProfile{position:absolute;top:0;left:0;right:0;bottom:0;pointer-events:none;-webkit-box-direction:normal;-webkit-box-orient:vertical;-webkit-flex-direction:column;flex-direction:column}.steamAuth .steamProfile .SteamUserName{line-height:1em;text-align:center;font-weight:bold;font-size:1.1rem;padding:2px}.steamAuth .steamProfile .OAARankedMMR{position:absolute;top:0;right:0;left:0;bottom:0;padding:1px 2px;-webkit-animation:-nav-mmr-rotate-ranked 6s linear infinite;animation:-nav-mmr-rotate-ranked 6s linear infinite}.steamAuth .steamProfile .OAARankedMMR::before{content:\\'Ranked:\\'}.steamAuth .steamProfile .OAAMMRValues{text-align:center;margin-top:auto;position:relative;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-align-items:center;align-items:center}.steamAuth .steamProfile .OAAMMRValues > *{-webkit-backface-visibility:hidden;backface-visibility:hidden}.steamAuth .steamProfile .OAAUnrankedMMR{padding:1px 2px;-webkit-animation:-nav-mmr-rotate-unranked 6s linear infinite;animation:-nav-mmr-rotate-unranked 6s linear infinite}.steamAuth .steamProfile .OAAUnrankedMMR::before{content:\\'Unranked:\\'}.steamAuth .steamAuthLink{background:transparent;border:0;cursor:pointer;padding:7px 11px;position:relative;z-index:10;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-align-items:center;align-items:center}.steamAuth .steamAuthLink:hover{background:rgba(0,0,0,0.2)}.steamAuth .steamAuthLink svg{width:2em;height:2em;margin-right:.4em}';\n\n                        document.head.appendChild(style);\n                    }\n\n                    window[rootObjectName].awaitModulePrepared('URL', function() {\n                        // TL`DR, this sets up a browser-side 'session' flow where the response can be read from the URL\n                        var items = document.querySelectorAll('.steamAuthLink');\n                        var i = 0;\n                        var j = items.length;\n\n                        for (i; i < j; i++) {\n                            items[i].setAttribute(\n                                'href',\n                                'https://steamcommunity.com/openid/login?' +\n                                    'openid.claimed_id=' + encodeURIComponent('http://specs.openid.net/auth/2.0/identifier_select') + '&' +\n                                    'openid.identity='   + encodeURIComponent('http://specs.openid.net/auth/2.0/identifier_select') + '&' +\n                                    'openid.mode='       + encodeURIComponent('checkid_setup') +                                      '&' +\n                                    'openid.ns='         + encodeURIComponent('http://specs.openid.net/auth/2.0') +                   '&' +\n                                    'openid.realm='      + encodeURIComponent(window.location.origin) +                               '&' +\n                                    'openid.return_to='  + encodeURIComponent(window.location.origin + window.location.pathname)\n                            );\n                        }\n\n                        // FIRST, check to see if our LS store has a valid entry that has not expired (We are going to locally store the Steam64 for 1 week)\n                        try {\n                            var steamAuthChallenge = window.localStorage.getItem('OAAGGS64');\n\n                            // Do we have a valid and non-expired Steam64 in cache?\n                            if (!steamAuthChallenge || (steamAuthChallenge.indexOf(':') === -1)) {\n                                // Check our response URL...we might already have this data available\n                                var identity = window[rootObjectName].URL.searchParamValue('openid.identity');\n\n                                if (identity && (identity = identity.replace(/^https:\\/\\/steamcommunity.com\\/openid\\/id\\//, ''))) {\n                                    userSteam64 = identity;\n\n                                    handleFetchUserProfileData();\n                                } else {\n                                    handleUpdateNavToRequiresAuthentication();\n                                }\n                            } else {\n                                var steamAuthSet = steamAuthChallenge.split(':');\n\n                                if (Number(steamAuthSet[0]) > Date.now()) {\n                                    userSteam64 = steamAuthSet[1];\n\n                                    handleFetchUserProfileData();\n                                } else {\n                                    handleUpdateNavToRequiresAuthentication();\n                                }\n                            }\n                        } catch (e) {\n                            // TODO: Handle private browsing mode maybe?  IOS throws an exception here if we are in private browsing mode\n                        }\n                    });\n                }.bind(this),\n\n                registerOnAuthenticatedCallback: function(callback) {\n                    if (hasBeenAuthenticated) {\n                        window[rootObjectName].handleRunCallback(callback);\n                    } else {\n                        onAuthenticatedCallbacks.push(callback);\n                    }\n                }.bind(this),\n\n                get currentUserSteam32() {\n                    if (!hasBeenAuthenticated) {\n                        return '0';\n                    }\n\n                    // Split the string into char arrays sop we can do the math manually (Doing the plan math will always fail...)\n                    var steam64chars     = userSteam64.split('').reverse();\n                    var steamTConstChars = '76561197960265728'.split('').reverse();\n                    var steam32Chars     = [];\n\n                    var i = 0;\n                    var j = steam64chars.length;\n\n                    var carry = false;\n                    var baseInt;\n                    var subtInt;\n                    var resultInt;\n\n                    // TODO: Maybe there is a case where the 64 is less than the translation constant?\n                    for (i; i < j; i++) {\n                        baseInt = Number(steam64chars[i]);\n                        subtInt = Number(steamTConstChars[i]);\n\n                        // Are we carrying a number from the last operation?\n                        if (carry) {\n                            baseInt = (baseInt - 1);\n                        }\n\n                        carry = false;\n\n                        resultInt = baseInt - subtInt;\n\n                        if (resultInt < 0) {\n                            resultInt = (resultInt + 10);\n\n                            carry = true;\n                        }\n\n                        steam32Chars.push(resultInt.toString());\n                    }\n\n                    return steam32Chars.reverse().join('').replace(/^[0]+/, '');\n                },\n\n                get currentUserSteam64() {\n                    return userSteam64;\n                },\n            };\n        }());\n\n        window[rootObjectName].moduleReady(window[rootObjectName].SteamAuth.__init);\n    });\n}());\n"]}