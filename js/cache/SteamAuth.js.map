{"version":3,"sources":["SteamAuth.js"],"names":["rootObjectName","window","__GRN","ready","SteamAuth","onAuthenticatedCallbacks","hasBeenAuthenticated","userManagerInstance","handleUpdateNavToAuthenticated","user","handleUpdateNavToRequiresAuthentication","i","j","length","handleRunCallback","authButton","document","querySelector","classList","remove","addEventListener","signinPopup","__init","awaitModulePrepared","Debug","writeConsoleMessage","LOG_LEVEL_INFO","Oidc","Log","logger","console","UserManager","authority","client_id","redirect_uri","location","origin","pathname","scope","userStore","WebStorageStateStore","store","localStorage","checkSessionInterval","popupWindowTarget","open","automaticSilentRenew","getUser","then","catch","bind","this","registerOnAuthenticatedCallback","callback","push","currentUserSteam32","currentUserSteam64","modulePrepared","moduleReady"],"mappings":"CAAE,WACE,IAAIA,EAAiBC,OAAOC,MAE5BD,OAAOD,GAAgBG,MAAM,WACzBF,OAAOD,GAAgBI,UAAa,WAChC,IAAIC,KACAC,GAA2B,EAC3BC,EAA2B,KAE3BC,EAAiC,SAASC,GACrCA,GACDC,IAGJJ,GAAuB,EAKvB,IAHA,IAAIK,EAAI,EACJC,EAAIP,EAAyBQ,OAEzBF,EAAIC,EAAGD,IACXV,OAAOD,GAAgBc,kBAAkBT,EAAyBM,KAItED,EAA0C,WAC1C,IAAIK,EAAaC,SAASC,cAAc,uBAExCF,EAAWG,UAAUC,OAAO,WAE5BJ,EAAWK,iBAAiB,QAASb,EAAoBc,aACzDN,EAAWK,iBAAiB,MAASb,EAAoBc,aACzDN,EAAWK,iBAAiB,QAASb,EAAoBc,cAG7D,OACIC,OAAQ,WACJrB,OAAOD,GAAgBuB,oBAAoB,SAAU,WACjDtB,OAAOD,GAAgBuB,oBAAoB,QAAS,WAChDtB,OAAOD,GAAgBwB,MAAMC,oBAAoB,oCAAqC,YAAaxB,OAAOD,GAAgBwB,MAAME,kBAGpIC,KAAKC,IAAIC,OAASC,SAGlBvB,EAAsB,IAAIoB,KAAKI,aAC3BC,UAAW,qCACXC,UAAW,mCACXC,aAAcjC,OAAOkC,SAASC,OAASnC,OAAOkC,SAASE,SACvDC,MAAO,SACPC,UAAW,IAAIZ,KAAKa,sBAChBC,MAAOxC,OAAOyC,eAElBC,qBAAsB,IACtBC,kBAAmB3C,OAAO4C,KAC1BC,sBAAsB,KAGNC,UACfC,KAAKxC,GACLyC,MAAMvC,MAEjBwC,KAAKC,MAEPC,gCAAiC,SAASC,GAClC/C,EACAL,OAAOD,GAAgBc,kBAAkBuC,GAEzChD,EAAyBiD,KAAKD,IAEpCH,KAAKC,MAEPI,yBACI,OAAO,GAGXC,yBACI,OAAO,IAxEgB,GA6EnCvD,OAAOD,GAAgByD,eAAe,aACtCxD,OAAOD,GAAgB0D,YAAYzD,OAAOD,GAAgBI,UAAUkB,UAlF3E","file":"SteamAuth.js","sourcesContent":["!(function() {\n    var rootObjectName = window.__GRN;\n\n    window[rootObjectName].ready(function() {\n        window[rootObjectName].SteamAuth = (function () {\n            var onAuthenticatedCallbacks = [];\n            var hasBeenAuthenticated     = false;\n            var userManagerInstance      = null;\n\n            var handleUpdateNavToAuthenticated = function(user) {\n                if (!user) {\n                    handleUpdateNavToRequiresAuthentication();\n                }\n\n                hasBeenAuthenticated = true;\n\n                var i = 0;\n                var j = onAuthenticatedCallbacks.length;\n\n                for (i; i < j; i++) {\n                    window[rootObjectName].handleRunCallback(onAuthenticatedCallbacks[i]);\n                }\n            };\n\n            var handleUpdateNavToRequiresAuthentication = function() {\n                var authButton = document.querySelector('body>nav .steamAuth');\n\n                authButton.classList.remove('loading');\n\n                authButton.addEventListener('click', userManagerInstance.signinPopup);\n                authButton.addEventListener('tap',   userManagerInstance.signinPopup);\n                authButton.addEventListener('touch', userManagerInstance.signinPopup);\n            };\n\n            return {\n                __init: function() {\n                    window[rootObjectName].awaitModulePrepared('OpenID', function() {\n                        window[rootObjectName].awaitModulePrepared('Debug', function() {\n                            window[rootObjectName].Debug.writeConsoleMessage('Initializing Steam authentication', 'SteamAuth', window[rootObjectName].Debug.LOG_LEVEL_INFO);\n                        });\n\n                        Oidc.Log.logger = console;\n\n                        // TODO: Do background Steam authentication first, then bind prompted authentication if that fails\n                        userManagerInstance = new Oidc.UserManager({\n                            authority: 'https://steamcommunity.com/openid/',\n                            client_id: '0FA551D64997BEF92A8FC8CBB1ECBA2B',\n                            redirect_uri: window.location.origin + window.location.pathname,\n                            scope: 'openid',\n                            userStore: new Oidc.WebStorageStateStore({\n                                store: window.localStorage\n                            }),\n                            checkSessionInterval: 30000,\n                            popupWindowTarget: window.open,\n                            automaticSilentRenew: true,\n                        });\n\n                        userManagerInstance.getUser()\n                            .then(handleUpdateNavToAuthenticated)\n                            .catch(handleUpdateNavToRequiresAuthentication);\n                    });\n                }.bind(this),\n\n                registerOnAuthenticatedCallback: function(callback) {\n                    if (hasBeenAuthenticated) {\n                        window[rootObjectName].handleRunCallback(callback);\n                    } else {\n                        onAuthenticatedCallbacks.push(callback);\n                    }\n                }.bind(this),\n\n                get currentUserSteam32() {\n                    return 0;\n                },\n\n                get currentUserSteam64() {\n                    return 0;\n                },\n            };\n        }());\n\n        window[rootObjectName].modulePrepared('SteamAuth');\n        window[rootObjectName].moduleReady(window[rootObjectName].SteamAuth.__init);\n    });\n}());\n"]}