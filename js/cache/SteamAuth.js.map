{"version":3,"sources":["SteamAuth.js"],"names":["rootObjectName","window","__GRN","ready","SteamAuth","onAuthenticatedCallbacks","userManagerInstance","handleUpdateNavToAuthenticated","handleUpdateNavToRequiresAuthentication","authButton","document","querySelector","classList","remove","addEventListener","signinPopup","__init","awaitModulePrepared","Debug","writeConsoleMessage","LOG_LEVEL_INFO","Oidc","Log","logger","console","UserManager","authority","client_id","redirect_uri","location","origin","pathname","scope","userStore","WebStorageStateStore","store","localStorage","checkSessionInterval","popupWindowTarget","open","automaticSilentRenew","getUser","then","catch","bind","this","registerOnAuthenticatedCallback","callback","push","currentUserSteam32","currentUserSteam64","modulePrepared","moduleReady"],"mappings":"CAAE,WACE,IAAIA,EAAiBC,OAAOC,MAE5BD,OAAOD,GAAgBG,MAAM,WACzBF,OAAOD,GAAgBI,UAAa,WAChC,IAAIC,KAEAC,EAA2B,KAE3BC,EAAiC,aAIjCC,EAA0C,WAC1C,IAAIC,EAAaC,SAASC,cAAc,uBAExCF,EAAWG,UAAUC,OAAO,WAE5BJ,EAAWK,iBAAiB,QAASR,EAAoBS,aACzDN,EAAWK,iBAAiB,MAASR,EAAoBS,aACzDN,EAAWK,iBAAiB,QAASR,EAAoBS,cAG7D,OACIC,OAAQ,WACJf,OAAOD,GAAgBiB,oBAAoB,SAAU,WACjDhB,OAAOD,GAAgBiB,oBAAoB,QAAS,WAChDhB,OAAOD,GAAgBkB,MAAMC,oBAAoB,oCAAqC,YAAalB,OAAOD,GAAgBkB,MAAME,kBAGpIC,KAAKC,IAAIC,OAASC,SAGlBlB,EAAsB,IAAIe,KAAKI,aAC3BC,UAAW,qCACXC,UAAW,mCACXC,aAAc3B,OAAO4B,SAASC,OAAS7B,OAAO4B,SAASE,SACvDC,MAAO,SACPC,UAAW,IAAIZ,KAAKa,sBAChBC,MAAOlC,OAAOmC,eAElBC,qBAAsB,IACtBC,kBAAmBrC,OAAOsC,KAC1BC,sBAAsB,KAGNC,UACfC,KAAKnC,GACLoC,MAAMnC,MAEjBoC,KAAKC,MAEPC,gCAAiC,SAASC,GAIlC1C,EAAyB2C,KAAKD,IAEpCH,KAAKC,MAEPI,yBACI,OAAO,GAGXC,yBACI,OAAO,IA7DgB,GAkEnCjD,OAAOD,GAAgBmD,eAAe,aACtClD,OAAOD,GAAgBoD,YAAYnD,OAAOD,GAAgBI,UAAUY,UAvE3E","file":"SteamAuth.js","sourcesContent":["!(function() {\n    var rootObjectName = window.__GRN;\n\n    window[rootObjectName].ready(function() {\n        window[rootObjectName].SteamAuth = (function () {\n            var onAuthenticatedCallbacks = [];\n            var hasBeenAuthenticated     = false;\n            var userManagerInstance      = null;\n\n            var handleUpdateNavToAuthenticated = function() {\n\n            };\n\n            var handleUpdateNavToRequiresAuthentication = function() {\n                var authButton = document.querySelector('body>nav .steamAuth');\n\n                authButton.classList.remove('loading');\n\n                authButton.addEventListener('click', userManagerInstance.signinPopup);\n                authButton.addEventListener('tap',   userManagerInstance.signinPopup);\n                authButton.addEventListener('touch', userManagerInstance.signinPopup);\n            };\n\n            return {\n                __init: function() {\n                    window[rootObjectName].awaitModulePrepared('OpenID', function() {\n                        window[rootObjectName].awaitModulePrepared('Debug', function() {\n                            window[rootObjectName].Debug.writeConsoleMessage('Initializing Steam authentication', 'SteamAuth', window[rootObjectName].Debug.LOG_LEVEL_INFO);\n                        });\n\n                        Oidc.Log.logger = console;\n\n                        // TODO: Do background Steam authentication first, then bind prompted authentication if that fails\n                        userManagerInstance = new Oidc.UserManager({\n                            authority: 'https://steamcommunity.com/openid/',\n                            client_id: '0FA551D64997BEF92A8FC8CBB1ECBA2B',\n                            redirect_uri: window.location.origin + window.location.pathname,\n                            scope: 'openid',\n                            userStore: new Oidc.WebStorageStateStore({\n                                store: window.localStorage\n                            }),\n                            checkSessionInterval: 30000,\n                            popupWindowTarget: window.open,\n                            automaticSilentRenew: true,\n                        });\n\n                        userManagerInstance.getUser()\n                            .then(handleUpdateNavToAuthenticated)\n                            .catch(handleUpdateNavToRequiresAuthentication);\n                    });\n                }.bind(this),\n\n                registerOnAuthenticatedCallback: function(callback) {\n                    if (hasBeenAuthenticated) {\n                        window[rootObjectName].handleRunCallback(callback);\n                    } else {\n                        onAuthenticatedCallbacks.push(callback);\n                    }\n                }.bind(this),\n\n                get currentUserSteam32() {\n                    return 0;\n                },\n\n                get currentUserSteam64() {\n                    return 0;\n                },\n            };\n        }());\n\n        window[rootObjectName].modulePrepared('SteamAuth');\n        window[rootObjectName].moduleReady(window[rootObjectName].SteamAuth.__init);\n    });\n}());\n"]}